---
- name: Install unison
  apt:
    name: "{{ item }}"
    update_cache: yes
  with_items:
    - unison
    - unison-all
    - cron
    - openssh-server

- name: enable cron
  action: service name=cron state=started
### path /var/www/wordpress

- name: enable open ssh
  become: true
  action: service name=sshd state=started

- name: Create ssh key
  become: true
  command: ssh-keygen -q -t rsa -f .ssh/ssh_host_rsa_key -C "" -N ""
  args:
    creates: .ssh/ssh_host_rsa_key

#- name: Copy ssh key
#  ansible.posix.authorized_key:
#    user: ubuntu
#    state: present
#    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"

  #become: true
  #command: ssh-copy-id ubuntu@109.120.181.30 #add ip address serv example ssh-copy-id username@remote_host

- name: Create a directory
  ansible.builtin.file:
    path: ~/.unison/
    state: directory
    mode: '0755'

- name: update unison/default.prf
  become: true
  ansible.builtin.copy:
    content: "auto = true\nbatch = true"
    dest: ~/.unison/default.prf

- name: Copy file
  become: true
  ansible.builtin.copy:
    content: "#!/bin/bash\nunison /var/www/wordpress ssh://109.120.181.30//var/www/wordpress"
    dest: /usr/bin/unisonsync.sh
    mode: '0755'

- name: Performs synchronization every 1 minutes
  ansible.builtin.cron:
    name: unisonsync
    minute: "*/1"
    user: ubuntu
    job: "/usr/bin/unisonsync.sh"
