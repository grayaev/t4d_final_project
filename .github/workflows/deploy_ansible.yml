name: AnsibleDeploy

on: [push]

jobs:
  build:
    
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v1
      - name: Set up Python 3.7
        uses: actions/setup-python@v1
        with:
          python-version: 3.7
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ansible==2.9.2 requests
          ansible-galaxy collection install community.mysql
      - name: set ansible config secrets
        env:
          DO_SSH_KEY: ${{ secrets.DO_SSH_KEY }}
        run: |
          mkdir .ssh
          echo "$DO_SSH_KEY" > .ssh/id_rsa
          chmod 600 .ssh/id_rsa
      - name: run exporters playbook
        run: |
          ansible-playbook -i inventory playbook.yml
#name: AncibleDeploy
#on:
#  # Triggers this Action on push or pull request events on the "main" branch and when manually requested from the "Actions" tab
#  push:
#    branches: [ main ]
#  workflow_dispatch:
#
#jobs:
#  deploy_code:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Run Ansible playbook
#        uses: dawidd6/action-ansible-playbook@v2.5.0
#        with:
#          playbook: playbook.yml
#          directory: ./
#          key: ${{ secrets.ansible_ssh_private_key }} # the ssh private key for ansible to use to connect to the servers, stored as "ansible_ssh_private_key" in the GitHub secrets
#          inventory: ${{ secrets.ansible_inventory }} # the ansible inventory to use, stored as "ansible_inventory" in the GitHub secrets